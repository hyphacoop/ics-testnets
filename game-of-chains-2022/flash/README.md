# Flash Chain Information

Contents

* [Status](#status)
* [Chain Data](#chain-data)

## Status

* Timeline
  * 2022-12-05: Proposal goes into voting period
  * 2022-12-08: Chain initialized

Flash will launch as a consumer chain through a governance proposal in the `provider` chain. Read the [Consumer Chain Start Process](/docs/Consumer-Chain-Start-Process.md) page for more details about the workflow.  

Flash uses a forked version of the Cosmos SDK [`Flash SDK`](https://github.com/clemensgg/flash-sdk) with updated default consensus timeout parameters, to allow a **target block production rate of ~1.7s / block**. We'll use this chain to test eventual issues with relayer performance due to diverging block times.

The following items will be included in the proposal:
* Genesis file hash
* The SHA256 is used to verify against the genesis file that the proposer has made available for review.
* This "fresh" genesis file cannot be used to run the chain: it must be updated with the CCV states after the spawn time is reached.
* Binary hash
* Spawn time
* Even if the proposal passes, the CCV states will not be available from the provider chain until after the spawn time is reached.

## Chain Data

### Binary

The binary published in this repo is the `flashd` binary built using the `clemensgg/flash` repo tag [v0.1.0](https://github.com/clemensgg/flash/releases/tag/v0.1.0). You can generate the binary following the [Get Started section](https://github.com/clemensgg/flash/tree/v0.1.0#get-started).  

* [Linux amd64 build](https://github.com/clemensgg/flash/releases/download/v0.1.0/flashd-v0.1.0-linux-amd64)
* Version: `v0.1.0`
* SHA256: `d99c27a84f3d37c3f1bbcfbb1c9187eadb695c77967706805692fe71176909c3`

### Genesis file

**The genesis file for Interchain Security consumer chains must include the CCV (Cross Chain Validation) state generated by the provider chain _after_ the spawn time is reached.**

_The final genesis file will be provided here shortly after the `spawn_time` has passed._

The fresh-genesis file with was generated using the following settings:

* Chain ID: `flash`
* Denom: `uflsh`
* Signed blocks window: `"30000"`
* Genesis accounts were added to provide funds for a faucet and a relayer that will be run by CryptoCrew.
* Genesis file **without CCV state**: [`flash-fresh-genesis.json`](flash-fresh-genesis.json), SHA256: `b35914fcf6fae5cd978705c0230f350e1fb2b1ae39c6dde2c0d0000ca42a1834`
  * **This is provided only for verification, this is not the genesis file validators should be running their nodes with.**

* **Final genesis file**: [`flash-final-genesis.json`](flash-final-genesis.json), SHA256: `496ef043b167f771d6807367e78fec37374f3fb247259ec5ab4798dfd8f2f681`

## Endpoints

* **p2p seeds : `a1f578af6dfe2e80543dc9144babe09979fc3ce4@tenderseed.ccvalidators.com:29099`**
* **p2p persistent peers : `309fc4130e9495897265a54980747f783391e153@65.109.37.154:16696,0ae9a4e98a43b00c194faa97d41311a34270e4dd@23.88.7.177:26756`**
* These peers represent the `CryptoCrew Validators` validator. 
* Please keep in mind that any validator that does not come online after 67% of the voting power is up and running, is likely to be slashed for downtime, potentially resulting in being jailed (the `signed_blocks_window` parameter is set to `30000`).

* Public REST-API (LCD) endpoint: https://rest.goc-flash.ccvalidators.com:443
* Public RPC endpoint: https://rpc.goc-flash.ccvalidators.com:443
* Public gRPC endpoint: grpc://grpc.goc-flash.ccvalidators.com:443
* Faucet: https://faucet.goc-flash.ccvalidators.com:443

## Join via Bash Script

On the node machine:
- Copy the `node_key.json` and `priv_validator_key.json` files for your validator.
  - **These should be the same ones as the ones from your provider node**.
- Run one of the following scripts:
  - Flash service: [flash-init.sh](./flash-init.sh)
  - Cosmovisor service: [flash-init-cv.sh](./flash-init-cv.sh)
- Wait until the spawn time is reached and the genesis file with the CCV states is available.
- Overwrite the genesis file with the one that includes the CCV states.
  - The default location is `$HOME/.flash/config/genesis.json`.
- Enable and start the service:
  - Flash
    ```
    sudo systemctl enable flash
    sudo systemctl start flash
    ```
  - Cosmovisor
    ```
    sudo systemctl enable cv-flash
    sudo systemctl start cv-flash
    ```
- To follow the log, use:
  - Flash: `journalctl -fu flash`
  - Cosmovisor: `journalctl -fu cv-flash`
- If the log does not show up right away, run `systemctl restart systemd-journald`.

## Assign dedicated validator key for `flash`

As per [proposal #44](https://testnet.mintscan.io/goc-provider/proposals/44), the `provider` chain will be upgraded at height `480681` (ETA `2022-12-08 16:15:13`). You can assign a dedicated validator key for `flash` after the upgrade has passed and before the `spawn_time` of `flash` has been reached. The estimated time window is about ~3.5 hours in between those events.  

You can use `cronjob` and the scripts below to automate the process.

- [generate consumer key script](./generate_consumer_key.sh)
- [assign consumer key script](./assign_consumer_key.sh)

Or use these steps to manually generate and assign a new key for `flash`:

1) after normal init of `flash` or [using the installscript](#join-via-bash-script), first generate a new `priv_validator_key.json`:
```sh
flashd init --home $HOME/TMP flash
PUBKEY=$(flashd --home $HOME/TMP tendermint show-validator)
cp $HOME/TMP/config/priv_validator_key.json $HOME/.flash/config
rm -r $HOME/TMP
echo "new key generated at $HOME/.flash/config/priv_validator_key.json"
echo "pubkey:"
echo "*****************************************"
echo $PUBKEY
echo "*****************************************"
```
2) **backup the priv_validator_key.json!** 

3) use the full pubkey from the output and paste it below. this script needs to be run on a machine with the updated `gaiad` version.
```sh
# enter your freshly generated pubkey from the first step, this transaction needs to be done on a machine with the updated gaiad version
PUBKEY='{"@type":"/cosmos.crypto.ed25519.PubKey","key":"..."}'

NODE_NAME=gaiad
NODE_HOME=$HOME/.gaia
KEY_NAME=validator
KEYRING_BACKEND=os
DENOM=uprov
CHAIN_ID=provider
CONSUMER_ID=flash
GAS_PRICES=0.0025uprov
RPC=https://rpc.provider-sentry-01.goc.earthball.xyz:443

${NODE_NAME} --home ${NODE_HOME} tx provider assign-consensus-key \
  ${CONSUMER_ID} \
  ${PUBKEY} \
  --from ${KEY_NAME} \
  --keyring-backend ${KEYRING_BACKEND} \
  --chain-id ${CHAIN_ID} \
  --gas auto \
  --gas-adjustment 1.5 \
  --gas-prices ${GAS_PRICES} \
  --node ${RPC} \
  -y
```
